var vlc = require('../vlc')([
  '-I', 'dummy',
  '-V', 'dummy',
  '--verbose', '1',
  '--no-video-title-show',
  '--no-disable-screensaver',
  '--no-snapshot-preview',
]);

var media = vlc.mediaFromFile(process.argv[2]);


media.parseSync();
var fn = function (state) {
  console.log('state changed', state);
};
media.on('MetaChanged', fn);


media.track_info.forEach(function (info) {
  console.log(info);
});

console.log(media.artist, '--', media.album, '--', media.title);
console.log('Media duration:', media.duration);

var player = vlc.mediaplayer;
player.on('MediaChanged', function () {
  console.log('Media changed');
});
player.media = media;


player.on('TimeChanged', function (pos) {
  console.log("time", pos);
});

player.play();
var POS = 0.5
player.position = POS;

var times = 0;

var poller = setInterval(function () {
  console.log('Poll:', player.position);
  times += 1;

  try {
    console.log('audio', player.audio.description);
    player.audio.toggle_mute();
    console.log('video', player.video.description);
  } catch (e) {
    console.log(e);
  }
  finally {
    if (times == 5) {
      player.stop();

      media.release();
      vlc.release();

      clearInterval(poller);
    }
  }
}, 500);

/*
setTimeout(function () {
  console.log('--- stoping ---', player.position);
  player.stop();
  clearInterval(poller);
}, media.duration + 100);
*/
